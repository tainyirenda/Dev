<!doctype html><meta charset="utf-8">
<title>Set a new password</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<div style="max-width:420px;margin:40px auto;font-family:system-ui">
  <h2>Set a new password</h2>
  <input id="p1" type="password" placeholder="New password (min 8)" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px">
  <input id="p2" type="password" placeholder="Repeat password" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;margin-top:8px">
  <button id="go" style="margin-top:10px;padding:10px 14px;border-radius:8px;background:#111827;color:#fff">Update</button>
  <p id="msg" style="margin-top:10px;color:#555"></p>
  <p><a href="API-connection.html">Back to sign in</a></p>
</div>
<script>
const API='https://afroauth-api-g7cqa9cvc4amhqh2.uksouth-01.azurewebsites.net';
const token=new URLSearchParams(location.search).get('token')||'';
go.onclick=async()=>{
  const msg=document.getElementById('msg');
  const p1=document.getElementById('p1').value, p2=document.getElementById('p2').value;
  if(!token){msg.textContent='Missing token.';return;}
  if(p1.length<8||p1!==p2){msg.textContent='Passwords must match and be at least 8 characters.';return;}
  msg.textContent='Updating...';
  try{
    const r=await fetch(API+'/api/reset-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token, password:p1})});
    const d=await r.json().catch(()=>null);
    if(!r.ok) throw new Error(d?.error||('HTTP '+r.status));
    msg.textContent='Done. You can now sign in.';
  }catch(e){msg.textContent=e.message;}
};
</script>
